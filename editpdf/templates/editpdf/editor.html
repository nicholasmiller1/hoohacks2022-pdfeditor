{% extends 'editpdf/base.html' %}

{% block title %}<title>Editor</title>{% endblock %}
{% block content %}
    <div class="sidebar">
        <table>
            <tr>
                <button id="pen-tool" class="tool" type="button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M362.7 19.32C387.7-5.678 428.3-5.678 453.3 19.32L492.7 58.75C517.7 83.74 517.7 124.3 492.7 149.3L444.3 197.7L314.3 67.72L362.7 19.32zM421.7 220.3L188.5 453.4C178.1 463.8 165.2 471.5 151.1 475.6L30.77 511C22.35 513.5 13.24 511.2 7.03 504.1C.8198 498.8-1.502 489.7 .976 481.2L36.37 360.9C40.53 346.8 48.16 333.9 58.57 323.5L291.7 90.34L421.7 220.3z"/></svg></button>
                <button id="text-tool" class="tool" type="button">T</button>
            </tr>
          <tr>
            <p> Edit Here </p>
    <textarea id="message-display" cols="100" rows="20"></textarea>
    <br/>
    <input id="message-input" type="text" size="100">
    <br/>
    <button onclick="onClick()">Send</button>
    {{ pdf_name|json_script:"pdf-name" }}

    <script>
      const pdfName = JSON.parse(document.getElementById('pdf-name').textContent);
      const ws_protocol = window.location.protocol == "https:" ? "wss://" : "ws://";

      const pdfEditSocket = new WebSocket(
        ws_protocol
        + window.location.host
        + '/ws/editpdf/editor/'
        + pdfName
        + '/'
      );
    
      pdfEditSocket.onmessage = function(event) {
        const data = JSON.parse(event.data);
        document.getElementById('message-display').value += (data.message + "\n");
      }
    
      pdfEditSocket.onclose = function(event) {
        console.log('Connection closed');
      }
    
      function onClick() {
        const messageElement = document.getElementById('message-input')
        const message = messageElement.value;
        pdfEditSocket.send(JSON.stringify({
          'message': message
        }));
        messageElement.value = '';
      }
    </script>
          </tr>
        </table>
    </div>
    <div class="main">
        <p> Edit Here </p>
        <canvas id="editor" width="850" height="1100" onload="draw()">Browser does not support Canvas</canvas>
        <p> end </p>
    </div>
    {% block scripts %}
        {% load static %}
        <script src="{% static 'editpdf/js/script.js' %}"></script>
    {% endblock %}  
{% endblock %}